@use '../variables/focus';
@use '../variables/semantic-tokens';
@use '../variables/spacers';
@use '../variables/typography';
@use './variables';

@use 'sass:map';

$btn-size-default: 32px !default;
$btn-size-lg: 40px !default;
$btn-size-sm: 24px !default;

.btn-group {
  position: relative;
  display: inline-flex;
  vertical-align: middle;

  .btn:not(.btn-circle) {
    position: relative;
    flex: 1 1 auto;
    border-radius: 0;
  }

  .btn-primary + .btn-primary {
    border-inline-start: 1px solid var(--btn-color, inherit);
  }

  > .btn:first-of-type:not(.btn-circle),
  > label:first-of-type .btn:not(.btn-circle) {
    border-start-start-radius: semantic-tokens.$element-button-radius;
    border-end-start-radius: semantic-tokens.$element-button-radius;
  }

  > .btn:last-of-type:not(.btn-circle),
  > label:last-of-type .btn:not(.btn-circle) {
    border-start-end-radius: semantic-tokens.$element-button-radius;
    border-end-end-radius: semantic-tokens.$element-button-radius;
  }

  > .btn-check:focus + .btn,
  > .btn:is(:hover, :active, .active, :focus-visible) {
    z-index: 1;
  }

  // Add separator border on primary button hover/focus to keep the layout consistent
  > .btn-primary:has(+ .btn-primary):is(:hover, :active, .active, :focus-visible)::after {
    content: '';
    position: absolute;
    inset-inline-end: 0;
    border-inline-end: 1px solid var(--btn-color, inherit);
    block-size: 100%;
  }

  > .btn:not(:first-of-type),
  label + label {
    margin-inline-start: -1px;
  }

  .btn {
    block-size: $btn-size-default;

    &.btn-lg {
      block-size: $btn-size-lg;
    }

    &.btn-sm {
      block-size: $btn-size-sm;
    }
  }

  .btn-icon,
  // @deprecated Will be removed in a future major version, use .btn-icon instead.
  .icon-only {
    inline-size: $btn-size-default;

    &.btn-lg {
      inline-size: $btn-size-lg;
    }

    &.btn-sm {
      inline-size: $btn-size-sm;
    }
  }

  // Dropdown toggle styling for split buttons
  .btn.dropdown-toggle {
    inline-size: $btn-size-sm;
    padding: 0;
    border-start-start-radius: 0;
    border-end-start-radius: 0;

    .dropdown-caret {
      margin-inline: 0;
      padding-inline: 0;
      transform-origin: center;
    }
  }

  &[inert] {
    opacity: semantic-tokens.$element-action-disabled-opacity;
  }
}

.btn-group .btn-check {
  + .btn {
    background: transparent;
    color: semantic-tokens.$element-text-primary;
    padding-block: calc(variables.$btn-padding-y - 1px);
    padding-inline: calc(variables.$btn-padding-x - 1px);
    border: 1px solid semantic-tokens.$element-ui-4;
    transition: none;

    &.btn-icon {
      inline-size: auto;
      padding-inline: map.get(spacers.$spacers, 5) - 1px;
    }

    // @deprecated Will be removed in a future major version, use .btn-icon instead.
    &.icon-only {
      inline-size: auto;
      min-inline-size: unset;
      padding-inline: map.get(spacers.$spacers, 5) - 1px;

      .icon {
        margin-inline: 0;
      }
    }
  }

  &:checked + .btn,
  + .btn:hover {
    color: semantic-tokens.$element-ui-0-hover;
  }

  &:checked + .btn {
    background: semantic-tokens.$element-action-secondary-active;
    border-color: semantic-tokens.$element-action-secondary-border-hover;
    z-index: 2;

    &:hover {
      color: semantic-tokens.$element-text-primary;
    }
  }

  &:focus-visible + .btn {
    @include focus.make-outline-focus();
    z-index: 3;
  }
}

// Optional: Group multiple button groups together for a toolbar
.btn-toolbar {
  display: flex;
  flex-wrap: wrap;
  justify-content: flex-start;

  .input-group {
    inline-size: auto;
  }
}
