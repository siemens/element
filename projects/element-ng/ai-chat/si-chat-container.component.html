<div class="chat-container d-flex flex-column flex-grow-1 px-6 px-md-9 py-6 w-100">
  @if (isEmpty()) {
    <div
      class="messages-empty-state d-flex flex-column align-items-center justify-content-center h-100 text-center p-6"
    >
      <si-empty-state
        [icon]="aiIcon()"
        [heading]="emptyStateTitle()"
        [content]="emptyStateDescription()"
      />
    </div>
  }
  <div
    #messagesContainer
    class="messages-container d-flex flex-column flex-grow-1 w-100 align-self-center"
    tabindex="0"
    (scroll)="onScroll()"
  >
    <ng-content />

    @if (displayMessages() !== undefined) {
      @for (message of displayMessages(); track message) {
        @if (message.template) {
          <!-- Template-based message -->
          <ng-container
            [ngTemplateOutlet]="message.template"
            [ngTemplateOutletContext]="message || {}"
          />
        } @else {
          <!-- Standard messages -->
          @if (message.type === 'user') {
            <si-user-message
              [class.last]="$last"
              [content]="getContentValue(message.content)"
              [attachments]="message.attachments || []"
              [actions]="getMessagePrimaryActions(message)"
              [secondaryActions]="getMessageSecondaryActions(message)"
              [actionParam]="actionParam()"
              [secondaryActionsLabel]="secondaryActionsLabel()"
              [contentFormatter]="markdownRenderer"
            />
          }

          @if (message.type === 'ai') {
            <si-ai-message
              [content]="getContentValue(message.content)"
              [loading]="
                getLoadingState(message.loading, message.content, isLatestMessage(message), false)
              "
              [actions]="getMessagePrimaryActions(message)"
              [secondaryActions]="getMessageSecondaryActions(message)"
              [actionParam]="actionParam()"
              [secondaryActionsLabel]="secondaryActionsLabel()"
              [contentFormatter]="markdownRenderer"
            />
          }

          @if (message.type === 'tool') {
            <si-tool-message
              [name]="message.name"
              [inputArguments]="message.inputArguments"
              [output]="getOutputValue(message.output)"
              [toolIcon]="message.icon ?? 'element-maintenance'"
              [loading]="getLoadingState(message.loading, message.output, false, true)"
              [inputArgumentsLabel]="toolInputArgumentsLabel()"
              [outputLabel]="toolOutputLabel()"
              [expandInputArguments]="shouldAutoExpandInputArguments(message)"
              [expandOutput]="shouldAutoExpandOutput(message)"
            />
          }
        }
      }
    }
  </div>

  <div class="chat-input-area py-3 pt-0 mt-6 d-flex flex-column align-items-center">
    @if (statusSeverity() && statusMessage()) {
      <si-inline-notification
        class="mb-6 w-100 overflow-hidden"
        [severity]="statusSeverity()!"
        [heading]="statusHeading()"
        [message]="statusMessage()!"
        [action]="statusAction()"
      />
    }

    <si-chat-input
      class="w-100"
      [placeholder]="inputPlaceholder()"
      [disabled]="disabled()"
      [sending]="inputSending()"
      [interruptible]="inputInterruptible()"
      [disclaimer]="disclaimer()"
      [actions]="inputPrimaryActions()"
      [secondaryActions]="inputSecondaryActions()"
      [allowAttachments]="allowAttachments()"
      [attachments]="attachments()"
      [accept]="accept()"
      [maxFileSize]="maxFileSize()"
      [actionParam]="actionParam()"
      [label]="inputLabel()"
      [secondaryActionsLabel]="secondaryActionsLabel()"
      [sendButtonLabel]="sendButtonLabel()"
      [sendButtonIcon]="sendButtonIcon()"
      [attachFileLabel]="attachFileLabel()"
      [removeAttachmentLabel]="removeAttachmentLabel()"
      [autoFocus]="!disableAutoFocus()"
      [(value)]="inputValue"
      (send)="onMessageSent($event)"
      (fileError)="onFileError($event)"
      (interrupt)="onInterrupt()"
    >
      <!-- Slot for additional custom actions -->
      <ng-content select="[slot=input-actions]" />
    </si-chat-input>
  </div>
</div>
