<button
  #colorInputBox
  #trigger="cdkOverlayOrigin"
  cdkOverlayOrigin
  class="input-color-box"
  type="button"
  [class.is-open]="isOverlayOpen()"
  [attr.aria-label]="(ariaLabel() | translate) + ' ' + color()"
  [disabled]="disabled()"
  (keydown.arrowDown)="openOverlay()"
  (blur)="blur()"
  (click)="openOverlay()"
>
  <div class="inside-box" [style.background-color]="'var(--' + color() + ')'"></div>
</button>

<ng-template
  cdkConnectedOverlay
  cdkConnectedOverlayBackdropClass="cdk-overlay-transparent-backdrop"
  [cdkConnectedOverlayHasBackdrop]="true"
  [cdkConnectedOverlayOrigin]="trigger"
  [cdkConnectedOverlayOpen]="isOverlayOpen()"
  [cdkConnectedOverlayFlexibleDimensions]="true"
  (backdropClick)="overlayDetach()"
  (detach)="overlayDetach()"
>
  <div
    #colorPaletteRef
    ngGrid
    enableSelection="true"
    colWrap="continuous"
    selectionMode="explicit"
    class="colors elevation-1 rounded-2 bg-base-1 p-4 mt-1 d-flex gap-4 flex-column"
  >
    @for (row of rows(); track $index) {
      <div ngGridRow class="d-flex flex-wrap gap-4">
        @for (paint of row; track paint) {
          <div ngGridCell class="swatch" [selected]="color() === paint">
            <input
              #swatchInput
              ngGridCellWidget
              type="radio"
              name="color"
              class="btn-check"
              [id]="paint"
              [attr.aria-label]="paint"
              [value]="paint"
              [checked]="color() === paint"
              (change)="selectColor(paint)"
              (keydown.enter)="selectColor(paint)"
              (keydown.tab)="overlayDetach()"
            />
            <label
              class="color-box swatch-label"
              [attr.for]="paint"
              [style.background]="'var(--' + paint + ')'"
            >
              @if (color() === paint) {
                <si-icon class="icon text-inverse" [icon]="icons.elementOk" />
              }
            </label>
          </div>
        }
      </div>
    }
  </div>
</ng-template>
